<html>

<head>
	<script src="jquery.min.js"></script>
</head>

<body>
	<div id="c1"></div>
	<div id="c2"></div>
	<div id="c3"></div>
	<script src="highcharts.js"></script>
	<!-- <script src="wordcloud.js"></script> -->
	<script src="JLinq.js"></script>
	<script>
		var data = null;

		$.getJSON('smzdm-luckydraw.json', json => {
			json.forEach(item => {
				item.title = item.title.replace(/^第\d+期 /, '').replace(/【[^】]*】/, '');
				var endTime = item.endTime.replace('年', '-').replace('月', '-').replace('日 ', 'T') + ':00';
				item.endTime = new Date(Date.parse(endTime));
				item.endMonth = item.endTime.getFullYear() + '-' + (item.endTime.getMonth() + 1);
			});

			data = JLinq.from(json);

			var c1Data = data.groupBy(i => i.endMonth).select(g => {
				return {
					'key': g.key,
					'value': g.query.elements.length
				};
			});

			var c1 = Highcharts.chart('c1', {
				chart: {
					type: 'line',
					width: 600,
					height: 600
				},
				title: {
					text: '幸运屋 每月开奖统计 (' + c1Data.elements.length + ' 个月)',
				},
				xAxis: {
					categories: c1Data.select(i => i.key).elements
				},
				yAxis: {
					title: {
						text: '开奖数'
					}
				},
				series: [{
					name: '开奖数',
					data: c1Data.select(i => i.value).elements
				}],
				credits: {
					enabled: false
				}
			});

			var c2Data = data.groupBy(i => i.winnerName).select(g => {
				return {
					'key': g.key,
					'value': g.query.elements.length
				};
			}).orderByDescending(g => g.value).where(g => g.value > 2);

			var c2 = Highcharts.chart('c2', {
				chart: {
					type: 'bar',
					width: 600,
					height: 800
				},
				title: {
					text: '幸运屋 中奖榜 (' + c1Data.elements.length + ' 人中奖超过 2 次)'
				},
				xAxis: {
					categories: c2Data.select(i => i.key).elements
				},
				yAxis: {
					title: {
						text: '中奖数'
					}
				},
				series: [{
					name: '中奖数',
					data: c2Data.select(i => i.value).elements
				}],
				credits: {
					enabled: false
				}
			});

			// var c3Data = data.groupBy(i => i.title).select(g => {
			// 	return {
			// 		'name': g.key,
			// 		'weight': g.query.elements.length
			// 	};
			// }).orderByDescending(g => g.weight).where(g => g.weight > 10);

			// var c3 = Highcharts.chart('c3', {
			// 	chart: {
			// 		width: 600,
			// 		height: 600
			// 	},
			// 	title: {
			// 		text: '幸运屋 奖品榜 (共 ' + c3Data.elements.length + ' 种奖品)'
			// 	},
			// 	series: [{
			// 		type: 'wordcloud',
			// 		data: c3Data.elements
			// 	}],
			// 	credits: {
			// 		enabled: false
			// 	}
			// });
		});
	</script>
</body>

</html>